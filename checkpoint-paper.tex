\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite, url}
% Enable the following line if you want highlighted hyperlink to citation and references
%\usepackage{hyperref}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Transaction Finality through Ledger Checkpoints 
	\thanks{This research is funded by KONA Software Lab, Limited.}
}

\author{
	\IEEEauthorblockN{Ratul Antik Das}
	\IEEEauthorblockA{\textit{Research and Development} \\
	\textit{Kona Software Lab}\\
		Dhaka, Bangladesh \\
		ratul.antik@konasl.com}
	\and		
	\IEEEauthorblockN{Md. Muhaimin Shah Pahalovi}
	\IEEEauthorblockA{\textit{Research and Development} \\
	\textit{Kona Software Lab}\\
		Dhaka, Bangladesh \\
		muhaimin.shah@konasl.com}		
	\and
	\IEEEauthorblockN{Muhammad Yanhaona}
	\IEEEauthorblockA{\textit{Research and Development} \\
	\textit{Kona Software Lab}\\
		Dhaka, Bangladesh \\
		nur.yanhaona@konasl.com}
}
\maketitle

\begin{abstract}
\end{abstract}

\begin{IEEEkeywords}
Computer Networks, peer-to-peer computing, distributed information systems
\end{IEEEkeywords}

\section{Introduction}
Since the publication of Satoshi Nakamoto's 2008 seminal paper \cite{bitcoin} that begot it, the blockchain technology has spurred a flurry of commercial activities. Initially the interest on blockchain technology was solely due to its prospect as a harbinger of alternative currency systems maintained by the masses. Blockchain based digital currencies, called \textit{cryptocurrencies}, gained significant momentum in the wake of the 2008 global financial crisis \cite{fincrisis}. Following the trail of Bitcoin \cite{bitcoin}, the first cryptocurrency, several cryptocurrencies \cite{bitcoinCash} \cite{David:2018:DCW:3208446} \cite{Takashima:2018:LUG:3235215} \cite{dogecoin} \cite{neo} with their own blockchain networks appeared in the market.
 
Subsequently, Ethereum \cite{Wood2014EthereumAS} demonstrated that a blockchain network can be utilized as a decentralized state machine that serves not only as a maintainer of a distributed ledger of cryptocurrency transactions but also a trusted computation engine for generic computer codes called \textit{smart contracts}. The logic encoded in a smart contract can define the rules of interactions among mutually untrusted parties and subsequently enforces them during the contract execution, thus eliminating the chance of a dispute. The idea of enforcing business negotiations using a computer code was decades old \cite{FM548} but did not get traction due to a central missing piece: there was no global computer whose execution result could be trusted. The discovery of the blockchain smart contract solved that problem and led to widespread interest in the technology from numerous application domains. Some pundits even hail the blockchain technology as a revolution that can transform the global economy \cite{blockchainRevolution1} \cite{blockchainRevolution2}.

From a technological standpoint, a blockchain system is a decentralized network of peers who maintains the state of a distributed ledger -- \textit{the blockchain} -- by each executing/validating all the transactions sent to it. The current state of the ledger is updated by adding a block of transactions. Each block has a pointer to its previous block; hence forming a chain called the blockchain. In Nakamoto's proposal \cite{bitcoin}, a peer who wants to append a valid block in the blockchain has to solve a computational puzzle whose solution is difficult but verification is cheap. The solution of the puzzle becomes a part of the block the peer is trying to append in the blockchain. This serves as a \textit{Proof of Work} (PoW) \cite{Back02hashcash} of the peer to the rest of the network. Combined with the blockchain data structure, PoW provides a simple basis for concensus \cite{Barborak:1993:CPF:152610.152612} among the network peers about the state of the ledger.

Users of a peer-to-peer network send transaction requests to arbitrary peers (or subset of peers). It is theoratically impossible to ensure that all transactions will reach all peers within a defined time interval given that even network connectivity among the peers cannot be guaranteed \cite{Fischer1983TheCP}. Consequently, a deterministic ordering of the requested transactions is also unacheivable. Given this problem, each peer of the blockchain network arbitrarily picks among the transactions it received from the users for processing  and tries to add blocks in its local version of the chain using those transactions. Whenever it receives a valid blockchain from any of its network neighbors that is longer -- i.e., has more work being done on it -- than its own version, it accepts the longer chain as canonical and tries to redo its transactions in that longer chain. 

Recent alternatives to PoW based consensus for public blockchain networks such as \textit{Proof of Stake} (PoS) \cite{casper} or \textit{Proof of Elapsed Time} (PoET) \cite{poet} work under the same principal. These protocols change the block construction process and the critera for deciding the best among candidate blockchains. The chance that a better blockchain will replace the current local chain of a peer remains regardless of their protocol differences. Consequently, the long term persistance of blockchain transactions is always a probabilistic guarantee. Currently, guaranteed permanence -- commonly called \textit{transaction finality} -- in blockchain technology is available only under stringent trust and connectivity contraints among the network peers \cite{David2014TheRP, Mazi√®res15thestellar}. These constraints are typically difficult to apply in scalable, peer-to-peer, public networks.   

However, the probabilistic permanence of transactions is a serious hindrance for blockchain technology adoption in modeling real-world business and financial interactions. This is because, unlike blockchain transactions, real-world consequences are typically irreversible or non-replayable. If a product is sold, it is sold. If a service is given, it is given. If an aggrement is signed, it is signed. Reversals of consequent payment transactions in the blockchain cannot nullify them. Hence, the transaction finality problem must be solved to realize blockchain technology's potential in documenting real-world interactions and for cryptocurrencies' acceptance in all kinds of payments.

This paper describes the transaction finality solution of the \textit{Kona blockchain platform}: a blockchain solution supporting smart contracts with additional features needed for porting financial and business applications on a peer-to-peer blockchain network incentivised by PoW mining. Finality is achieved by periodically establishing network-wide consensus about \textit{accepted, irreversible state} of the blockchain ledger we call a \textit{checkpoint}. All transactions up to the latest checkpoint are final, thus, can be safely used for any real-world decision making. Transcations mined into blocks after the latest checkpoint are only probabilistically secure until they are included into the next checkpoint.

The checkpoint establishment process, we call \textit{the checkpoint protocol}, neither compromises the PoW mining protocol nor does it necessitate any new network connectivity constraints among the mining peers. Miners' collaboration during checkpoint establishment is incentivised by a PoW mining based voting scheme. The only addition to the network is a \textit{byzantine fault-tolerant} (BFT) \cite{Lamport:1982:BGP:357172.357176} support service that disburses checkpoint ballots, seals checkpoint blocks, and does nothing else. We also prove that under the current PoW incentive scheme, the addition of such a service is mandory for ensuring transaction finality in a peer-to-peer network. It can be proven that our checkpoint protocol is fair, non-exclusionary, and can only be interrupted by a successful DDoS attack \cite{Yu:2013:DDS:2556385} on the support service.          

This paper also describes how a byzantine fault-tolerant support service can be realized and incentivised so that it cannot willfully bias or destabilize the checkpoint protocol. The rest the paper is organized as follows:

\subsection{Paper Organization}
Section \ref{s-related-work} describes related work on transaction finality in blockchain technology; Section \ref{s-incentive} illustrates the current PoW incentive scheme's impact on miner collaboration and consequent challenges in achieving transaction finality; Section \ref{s-model} then establishes the model for the check-pointing problem and elaborates on modeling objectives; Section \ref{s-algorithm} presents our checkpoint protocol; Section \ref{s-analysis} analyses how the protocol meets the objectives of Section \ref{s-model}; Section \ref{s-implementation} then touches on some implementation concerns; Finally, Section \ref{s-conclusion} concludes the paper along with a discussion on future improvements to the protocol.  

\section{Related Work}
\label{s-related-work}
It has been theoretically proven that purely peer-to-peer blockchains are probabilistic state machines that cannot provide any finality guarantee \cite{7756226}. The proof follows easily from the fact that malicious peers can reach $51\%$ majority in a network and reverse all transactions. So any discussion of blockchain ledger stability assumes that the majority mining power is held by the honest peers. A more practical analysis \cite{10.1007/978-3-319-56614-6_22} shows that assuming a bounded network delay and no message loss, a blockchain network achieves consistency (i.e., transaction finality) with probablity approaching $1$. The problem is messages can be lost and the network delay bound cannot be predermined in practical peer-to-peer network even with majority honest peers. Hence, \textit{probabilistic} transaction finality is the best that can be achieved without any new restriction on the blockchain network.

However, existing blockchain consensus protocols that claim to provide transaction finality impose restrictions on network participation that are difficult to realize in a peer-to-peer setting where participants can join and leave at any time. For example, the Ripple \cite{David2014TheRP} protocol assumes that $80\%$ neighbors of each honest peer are honest and malicious neigbors cannot intercept communications between honest peers. Similarly, the Stellar consensus protocol \cite{Mazires15thestellar} assumes that the majority honest peers of the network form a connected sub-network that provides guaranteed message delivery. The Tendermint consensus protocol \cite{Buchman2018TheLG} also assumes $\frac{2}{3}$ majority of honest peers receives every message within a bounded time delay. Under this assumption, it provides a \textit{PBFT} \cite{Castro:1999:PBF:296806.296824} solution decentralized for blockchain technology domain. The central issue with all these protocols is that they assume a gossip communication protocol \cite{gossip} can be utilized as a mean to implement a reliable broadcast primitive \cite{Jalote:1994:FTD:179250} in a peer-to-peer network. This assumption is not theoretically valid, and these protocols can suffer stagnation when broadcast fails.          

The forerunner of the \textit{business blockchain movement}, Hyperledger, provides transaction finality for two of its blockchain solutions: \textit{Iroha} \cite{yac} and \textit{Fabric} \cite{patent:20180150799}. Both assume there is a BFT ordering service that orders and reliabily delivers messages to all network peers. The network is definitely not peer-to-peer in either case and so far no convincing BFT solution for a distributed ordering service has been proposed. 

None of the aforementioned protocols work on a network incentivised by PoW mining. The only notable transaction finality solution for PoW blockchain network is Ethereum's Casper \cite{casper-gadget}. Casper assigns validator nodes (based on deposit of stakes) among the mining population for regularly voting on alternative blockchain versions. The version receiving $\frac{2}{3}$ majority of votes is called a finalized checkpoint.            

\section{PoW Incentive Scheme}
\label{s-incentive}

\section{Problem Modeling}
\label{s-model}

\section{Checkpoint Algorithm}
\label{s-algorithm}

\section{Fitness Analysis}
\label{s-analysis}

\section{Implementation Concerns}
\label{s-implementation}

\section{Conclusion}
\label{s-conclusion}
\subsection{Future Work}
 
\bibliographystyle{plain}
\bibliography{references.bib}

\end{document}
