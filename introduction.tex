\section{Introduction}
Since the publication of Satoshi Nakamoto's 2008 seminal paper \cite{bitcoin} that begot it, the blockchain technology has spurred a flurry of commercial activities. Initially the interest on blockchain technology was solely due to its prospect as a harbinger of alternative currency systems maintained by the masses. Blockchain based digital currencies, called \textit{cryptocurrencies}, gained significant momentum in the wake of the 2008 global financial crisis \cite{fincrisis}. Following the trail of Bitcoin \cite{bitcoin}, the first cryptocurrency, several cryptocurrencies \cite{bitcoinCash} \cite{David:2018:DCW:3208446} \cite{Takashima:2018:LUG:3235215} \cite{dogecoin} \cite{neo} with their own blockchain networks appeared in the market.
 
Subsequently, Ethereum \cite{Wood2014EthereumAS} demonstrated that a blockchain network can be utilized as a decentralized state machine that serves not only as a maintainer of a distributed ledger of cryptocurrency transactions but also a trusted computation engine for generic computer codes called \textit{smart contracts}. The logic encoded in a smart contract can define the rules of interactions among mutually untrusted parties and subsequently enforces them during the contract execution, thus eliminating the chance of a dispute. The idea of enforcing business negotiations using a computer code was decades old \cite{FM548} but did not get traction due to a central missing piece: there was no global computer whose execution result could be trusted. The discovery of the blockchain smart contract solved that problem and led to widespread interest in the technology from numerous application domains. Some pundits even hail the blockchain technology as a revolution that can transform the global economy \cite{blockchainRevolution1} \cite{blockchainRevolution2}.

From a technological standpoint, a blockchain system is a decentralized network of peers who maintain the state of a distributed ledger -- \textit{the blockchain} -- by each executing (or validating) all the transactions sent to it. The current state of the ledger is updated by adding a block of transactions. Each block has a pointer to its previous block; hence forming a chain called the blockchain. In Nakamoto's proposal \cite{bitcoin}, a peer who wants to append a valid block in the blockchain has to solve a computational puzzle whose solution is difficult but verification is cheap. The solution of the puzzle becomes a part of the block the peer is trying to append in the blockchain. This serves as a \textit{Proof of Work} (PoW) \cite{Back02hashcash} of the peer to the rest of the network. Combined with the blockchain data structure, PoW provides a simple basis for concensus \cite{Barborak:1993:CPF:152610.152612} among the network peers about the state of the ledger.

Users of a peer-to-peer network send transaction requests to arbitrary peers (or subset of peers). It is theoretically impossible to ensure that all transactions will reach all peers within a defined time interval given that mere network connectivity among the peers cannot be guaranteed \cite{Fischer1983TheCP}. Consequently, a deterministic ordering of the requested transactions is also unachievable. Given this problem, each peer of the blockchain network arbitrarily picks among the transactions it received from the users for processing  and tries to add blocks in its local version of the chain using those transactions. Whenever it receives a valid blockchain from any of its network neighbors that is longer -- i.e., has more work being done on it -- than its own version, it accepts the longer chain as canonical and tries to redo left-out transactions in the new canonical chain. 

Recent alternatives to PoW based consensus protocol for public blockchain networks such as \textit{Proof of Stake} (PoS) \cite{casper} or \textit{Proof of Elapsed Time} (PoET) \cite{poet} work under the same principal. These protocols change the block construction process and the critera for deciding the best among candidate blockchains. The chance that a better blockchain will replace the current local chain of a peer remains regardless of their protocol differences. Consequently, the long term persistance of blockchain transactions is always a probabilistic guarantee. Currently, guaranteed permanence -- commonly called \textit{transaction finality} -- in blockchain technology is available only under stringent trust and connectivity constraints among the network peers \cite{David2014TheRP, thestellar}. These constraints are typically difficult to apply in scalable, peer-to-peer, public networks.   

However, the probabilistic permanence of transactions is a serious hindrance for blockchain technology adoption in modeling real-world business and financial interactions. This is because, unlike blockchain transactions, real-world consequences are typically irreversible or non-re-playable. If a product is sold, it is sold. If a service is given, it is given. If an agreement is signed, it is signed. Reversal of consequent payment transactions in the blockchain cannot nullify them. Hence, the transaction finality problem must be solved to realize blockchain technology's potential in documenting real-world interactions and for cryptocurrencies' acceptance in all kinds of payments.

This paper describes the transaction finality solution of the \textit{Kona blockchain platform}: a blockchain solution supporting smart contracts with additional features needed for porting financial and business applications on a peer-to-peer blockchain network incentivised by PoW mining. Finality is achieved by periodically establishing network-wide consensus about \textit{accepted, irreversible state} of the blockchain ledger we call a \textit{checkpoint}. All transactions up to the latest checkpoint are final, thus, can be safely used for any real-world decision making. Transactions mined into blocks after the latest checkpoint are only probabilistically secure until they are included into the next checkpoint. 

The checkpoint establishment process, we call \textit{the checkpoint protocol}, neither compromises the PoW mining protocol nor does it necessitate any new network connectivity constraints among the mining peers. Miners' collaboration during checkpoint establishment is incentivised by a PoW mining based voting scheme. The only addition to the network is a \textit{byzantine fault-tolerant} (BFT) \cite{Lamport:1982:BGP:357172.357176} support service that disburses checkpoint ballots, seals checkpoint blocks, and does nothing else. The presence of the support service also ensures that a large group of new miners entering the network after a checkpoint cannot reverse a check-pointed state retroactively. We prove that under the current PoW incentive scheme, the addition of such a service is mandatory for ensuring transaction finality in a peer-to-peer network. It can be proven that our checkpoint protocol is fair, non-exclusionary, and can only be interrupted by a successful DDoS attack \cite{Yu:2013:DDS:2556385} on the support service.          

The paper provides a discussion of the design motives and a detailed analysis of the qualitative properties along with the description of the checkpoint protocol. In addition, the paper illustrates how a byzantine fault-tolerant support service can be realized and properly incentivised so that it cannot willfully bias or destabilize the checkpoint protocol. The rest of the paper is organized as follows:

\subsection{Paper Organization}
Section \ref{s-related-work} describes related work on transaction finality in blockchain technology; Section \ref{s-incentive} analyses a PoW incentive scheme's impact on miner collaboration and consequent challenges in achieving transaction finality; Section \ref{s-model} then establishes the model for the check-pointing problem and elaborates on modeling objectives; Section \ref{s-algorithm} presents our checkpoint protocol; Section \ref{s-analysis} analyses how the protocol meets the objectives of Section \ref{s-model}; Section \ref{s-implementation} then touches on some implementation concerns, in particular, it describes how to implement a BFT support service and discusses what can be its alternative in existing public blockchain networks; Finally, Section \ref{s-conclusion} concludes the paper along with a discussion on future improvements to the protocol.  
