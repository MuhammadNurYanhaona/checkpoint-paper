
\section{Implementation Concerns}
\label{s-implementation}
We discussed the theoretical soundness of our checkpoint protocol in the previous section. Now we discuss some important implementation concerns. In particular, two implementation issues merit especial attention: designing a BFT fault-tolerant support service and identifying valid participants for checkpoint consensus voting.       

\subsection{Distributed Support Service Implementation}
Given its essential role in the checkpoint protocol, the support service cannot be a centralized entity. That would make our entire transaction finality guarantee reliant on a centralized trust, consequently, unacceptable. On the other hand, when designing a distributed support service, we must be careful about not introducing the same transaction finality problem that the support service came to solve. If we ensure that support service nodes are directly connected then a traditional PBFT \cite{Castro:1999:PBF:296806.296824} solution would do. A more interesting solution, however, is to maintain a \textit{Proof of Authority (PoA)} blockchain among the support service nodes for the heartbeat database management.           

The support service nodes will be loosely time-synchronized and all aware of a predefined block mining interval for registering heartbeat messages from mining peers into new blocks. A mining peer can reach a random support service node during a particular heartbeat exchange. The peer will send a signed solution of a heartbeat-exchange puzzle constructed from the last block of heartbeat registry chain the peer is aware of and the peer's address. Upon reception of the heartbeat, the support service will validate the solution, provide an acknowledgement receipt that the peer's heartbeat will be included in the next block, and will propagate the heartbeat message to other peers. Heartbeats will be mined into block based on a majority vote that ensures that each block is final. 

The heartbeat acknowledgement receipt should contain, among other things, the current header block hash and block number of the heartbeat registry blockchain. If the peer falls behind tracking that chain, it can realize that from the returned block number and request the missing blocks from some support service node during its next heartbeat exchange. In addition, during their own interactions, the mining peers can exchange information about their views on the heartbeat registry chain to detect potential anomaly and synchronize this chain directly.

If designed in this manner, the mining peers can individually decide their own course of actions for the checkpoint protocol and easily verify the veracity of the support service or any of its nodes. Finally, note that the support service nodes can be realized in many different manners in a PoW blockchain network. For example, they can be selected from the mining peer population based on some notion of deposited stakes \cite{casper}. Alternatively, some dedicated non-mining nodes with guaranteed pair-wise network connectivity can be elected to provide the service. The core concern in support service nodes selection is network connectivity -- not trust -- as they have little leverage in manipulating the checkpoint protocol.
   
\subsection{Valid Voter Identification}
Ensuring that only valid votes are counted is a prerequisite to any voting based distributed consensus protocol. Our checkpoint protocol is no exception. If precautions are not taken, a tricky front-runner can run dummy identities that would vote for it and bias the result in its favor, or a malicious attacker can confuse the support service in believing that consensus has been reached and force it to publish checkpoint block sealing materials for an invalid chain.

The simplest solution to this problem is to make the mining peers go through some \textit{KYC} process and acquire public certificates to be able to participate in the checkpoint protocol. This is the approach taken in \textit{KONA blockchain platform}. As an alternative, an approach similar to Ethereum's validator stake deposit \cite{casper} can be adopted for voter registration. The most flexible solution to the problem that does not compromise the anonymity of the mining peers is to make the heartbeat exchange puzzle difficult enough to dissuade fake voters. However, that would significantly increase the network maintenance cost. To summarize, what solution to voter identification is appropriate depends on the nature of the underlying blockchain network.       

